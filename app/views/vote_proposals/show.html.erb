<% content_for :header do %>
  <%= render partial: "header" %>
<% end %>

<div id="preview">
  <div class="inner">
    <div class="image fit">
      
    </div>
    <div class="content">
      <header>
	<h2><%= @current.topic %></h2 >
      </header>
      <p><%= @current.description %></p>
      <p>
        <% @current.vote_proposal_options.each do |option| %>
          <% css_class = "button big red" %>
          <% if @vote
             ind = @vote.vote_proposal_options.index(option)
             if ind && (ind >= 0)
               css_class += " voted"
               par = {
                 vote: { vote_proposal_options_attributes: [{id: option.id, _destroy: true}] }
               }
             else
               par = { vote: { vote_proposal_option_ids: [option.id] } }
             end 
          %>
          <%= link_to option.name, update_vote_path(@vote, par), remote: true, method: :put, class: "#{css_class}" %>          
          <% else %>
            <% par = {
               vote: {
                 vote_proposal_id: @current.id,
                 vote_proposal_option_ids: [option.id]
               }
             }
          %>
          <%= link_to option.name, create_vote_path(par), remote: true, method: :post, class: "#{css_class}" %>
          <% end %>
        <% end %>
      </p>
    </div>    
  </div>
  
  <% if @prev %>
    <%= link_to vote_proposal_path(@prev), class: "nav previous" do %>
      <span class="fa fa-chevron-left"></span>
    <% end %>
  <% end %>
  <% if @next %>
    <%= link_to vote_proposal_path(@next), class: "nav next" do %>
      <span class="fa fa-chevron-right"></span>
    <% end %>
  <% end %>
    
</div>
